# LD3320_ESP32 语音识别库

这是一个专为 ESP32 设计的 LD3320 语音识别芯片库，用于智能加湿小车项目。

## 功能特性

- 支持离线语音识别
- 预设语音命令包括：唤醒词、加湿控制、移动控制
- 通过 SPI 接口与 ESP32 通信
- 支持继电器控制输出
- 中断驱动的识别结果处理

## 硬件连接

### LD3320 模块与 ESP32 连接（5 针脚版本）

| LD3320 引脚 | ESP32 引脚 | 功能描述     |
| ----------- | ---------- | ------------ |
| VCC         | 3.3V       | 电源正极     |
| GND         | GND        | 电源负极     |
| CS          | GPIO 15    | SPI 片选信号 |
| RST         | GPIO 4     | 复位信号     |
| IRQ         | GPIO 2     | 中断信号     |

### 继电器连接

| 功能         | ESP32 引脚 | 说明           |
| ------------ | ---------- | -------------- |
| 加湿器继电器 | GPIO 5     | 控制加湿器开关 |
| 前进电机     | GPIO 33    | 控制小车前进   |
| 后退电机     | GPIO 25    | 控制小车后退   |

注意：ESP32 的 SPI 引脚会自动配置：

- MOSI: GPIO 23
- MISO: GPIO 19
- SCK: GPIO 18

## 支持的语音命令

### 1. 唤醒词

- **"小一"** - 激活语音控制模式

### 2. 设备控制命令（需先说唤醒词）

- **"加湿"** - 开启加湿器
- **"关闭加湿"** - 关闭加湿器
- **"前进"** - 小车前进移动
- **"后退"** - 小车后退移动

## 使用方法

### 1. 包含头文件

```cpp
#include "LD3320_ESP32.h"
```

### 2. 创建实例

```cpp
LD3320_ESP32 ld3320;
```

### 3. 初始化

```cpp
void setup() {
    Serial.begin(115200);

    if (!ld3320.begin()) {
        Serial.println("LD3320初始化失败!");
        return;
    }

    Serial.println("LD3320初始化成功!");
}
```

### 4. 主循环中使用

```cpp
void loop() {
    // 运行语音识别
    if (ld3320.runASR()) {
        // 等待识别结果
        delay(3000);

        // 获取识别结果
        uint8_t result = ld3320.getResult();

        // 处理语音命令
        ld3320.handleVoiceCommand(result);
    }

    delay(1000);
}
```

## API 参考

### 公共方法

#### `bool begin()`

初始化 LD3320 模块，配置 SPI 接口和引脚。

- **返回值**: 成功返回 true，失败返回 false

#### `void reset()`

复位 LD3320 芯片。

#### `uint8_t runASR()`

启动语音识别过程。

- **返回值**: 成功返回 1，失败返回 0

#### `uint8_t getResult()`

获取语音识别结果代码。

- **返回值**: 识别到的命令代码

#### `void handleVoiceCommand(uint8_t commandCode)`

处理语音命令并控制相应设备。

- **参数**: commandCode - 语音命令代码

### 设备控制方法

#### `void setHumidifier(bool state)`

控制加湿器开关。

- **参数**: state - true 开启，false 关闭

#### `void setMotorForward(bool state)`

控制前进电机。

- **参数**: state - true 开启，false 关闭

#### `void setMotorBackward(bool state)`

控制后退电机。

- **参数**: state - true 开启，false 关闭

#### `void stopAllMotors()`

停止所有电机。

## 注意事项

1. **电源要求**: LD3320 模块需要稳定的 3.3V 电源供电
2. **识别距离**: 建议在 1-3 米范围内进行语音识别
3. **环境噪音**: 在安静环境下识别效果最佳
4. **命令间隔**: 两次语音命令之间建议间隔 3 秒以上
5. **唤醒机制**: 必须先说"小一"唤醒，然后才能执行控制命令

## 故障排除

### 问题 1: 初始化失败

- 检查硬件连接是否正确
- 确认电源供电是否稳定
- 检查 SPI 引脚配置

### 问题 2: 无法识别语音

- 确认是否先说了唤醒词"小一"
- 检查环境噪音是否过大
- 调整说话距离和音量

### 问题 3: 设备控制无反应

- 检查继电器连接是否正确
- 确认继电器电源是否充足
- 查看串口输出的调试信息

## 版本历史

- v1.0.0 - 初始版本，支持基本语音识别和设备控制功能
